{
  "version": 3,
  "sources": ["js-framework/src/betterncm-api/utils.ts", "js-framework/src/betterncm-api/react.ts", "js-framework/src/betterncm-api/base.ts", "js-framework/src/betterncm-api/fs.ts", "js-framework/src/betterncm-api/app.ts", "js-framework/src/betterncm-api/ncm.ts", "js-framework/src/betterncm-api/tests.ts", "js-framework/src/betterncm-api/index.ts", "js-framework/src/plugin-manager/components/button.tsx", "js-framework/src/plugin-manager/components/progress-ring.tsx", "js-framework/src/plugin-manager/components/header.tsx", "js-framework/src/plugin-manager/components/safe-mode-info.tsx", "js-framework/src/plugin-manager/components/warning.tsx", "js-framework/src/plugin-manager/index.tsx", "js-framework/src/plugin.ts", "js-framework/src/loader.ts"],
  "sourcesContent": ["export namespace utils {\n\ttype Selector =\n\t\t| keyof HTMLElementTagNameMap\n\t\t| keyof SVGElementTagNameMap\n\t\t| string;\n\texport function waitForElement<K extends keyof HTMLElementTagNameMap>(\n\t\tselector: K,\n\t\tinterval?: number,\n\t): Promise<HTMLElementTagNameMap[K] | null>;\n\texport function waitForElement<K extends keyof SVGElementTagNameMap>(\n\t\tselector: K,\n\t\tinterval?: number,\n\t): Promise<SVGElementTagNameMap[K] | null>;\n\texport function waitForElement<E extends Element = Element>(\n\t\tselector: string,\n\t\tinterval?: number,\n\t): Promise<E | null>;\n\texport function waitForElement(selector: Selector, interval = 100) {\n\t\treturn waitForFunction(() => document.querySelector(selector), interval);\n\t}\n\n\t/**\n\t * \u5C06\u6307\u5B9A\u7684\u51FD\u6570\u505A\u9632\u6296\u5904\u7406\n\t * @param callback \u9700\u8981\u88AB\u8C03\u7528\u7684\u56DE\u8C03\u51FD\u6570\n\t * @param waitTime \u9700\u8981\u7B49\u5F85\u591A\u957F\u65F6\u95F4\uFF0C\u5355\u4F4D\u6BEB\u79D2\n\t * @returns \u5305\u88C5\u540E\u7684\u9632\u6296\u51FD\u6570\n\t */\n\texport function debounce<T extends Function>(\n\t\tcallback: T,\n\t\twaitTime: number,\n\t): T {\n\t\tlet timer = 0;\n\t\treturn function debounceClosure() {\n\t\t\tconst self = this;\n\t\t\t// rome-ignore lint/style/noArguments: \u9632\u6296\u51FD\u6570\n\t\t\tconst args = arguments;\n\t\t\tif (timer) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t}\n\t\t\ttimer = setTimeout(callback.bind(self, args), waitTime);\n\t\t} as unknown as T;\n\t}\n\n\texport function escapeData(\n\t\tdata: string | ArrayLike<number> | ArrayBufferLike,\n\t): string {\n\t\tconst encoded =\n\t\t\ttypeof data === \"string\"\n\t\t\t\t? new TextEncoder().encode(data)\n\t\t\t\t: new Uint8Array(data);\n\t\tif (encoded.length > 0) {\n\t\t\tconst result: string[] = [];\n\t\t\tfor (let i = 0; i < encoded.length; i++) {\n\t\t\t\tresult.push(\"%\");\n\t\t\t\tresult.push(encoded[i].toString(16).padStart(2, \"0\"));\n\t\t\t}\n\t\t\treturn result.join(\"\");\n\t\t} else {\n\t\t\treturn \"\";\n\t\t}\n\t}\n\n\t/**\n\t * \u91CD\u590D\u8C03\u7528\u67D0\u51FD\u6570\uFF0C\u76F4\u5230\u5176\u8FD4\u56DE\u4EFB\u610F\u771F\u503C\uFF0C\u5E76\u8FD4\u56DE\u8BE5\u771F\u503C\u3002\n\t * @param func \u51FD\u6570\n\t * @param interval \u91CD\u590D\u8C03\u7528\u65F6\u95F4\u95F4\u9694\n\t * @returns `func` \u51FD\u6570\u7684\u8FD4\u56DE\u503C\n\t */\n\texport function waitForFunction<T>(\n\t\tfunc: () => T,\n\t\tinterval = 100,\n\t): Promise<T> {\n\t\treturn new Promise((rs) => {\n\t\t\tconst handle = setInterval(() => {\n\t\t\t\tconst result = func();\n\t\t\t\tif (result) {\n\t\t\t\t\tclearInterval(handle);\n\t\t\t\t\trs(result);\n\t\t\t\t}\n\t\t\t}, interval);\n\t\t});\n\t}\n\n\t/**\n\t * \u521B\u5EFA\u4E00\u4E2A\u5C06\u5728\u4E00\u5B9A\u65F6\u95F4\u540E resolve \u7684 Promise\n\t * @param ms \u5EF6\u8FDF\u65F6\u95F4\uFF0C\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\u3002\n\t * @returns \u5C06\u5728ms\u6BEB\u79D2\u540Eresolve\u7684\u4E00\u4E2APromise\n\t */\n\texport function delay(ms: number) {\n\t\treturn new Promise((rs) => setTimeout(rs, ms));\n\t}\n\n\t/**\n\t * \u7B80\u6613\u7684\u521B\u5EFA\u4E00\u4E2A\u5143\u7D20\u7684\u51FD\u6570\n\t * @deprecated \u65E9\u671F\u672A\u4F7F\u7528 React \u65F6\u5199\u7684\u8F85\u52A9\u51FD\u6570\uFF0C\u5DF2\u5F03\u7528\uFF0C\u8BF7\u8003\u8651\u4F7F\u7528\u81EA\u5E26\u7684 React \u6784\u5EFA\u590D\u6742\u9875\u9762\u3002\n\t * @param tag \u5143\u7D20\u7C7B\u578B\n\t * @param settings \u5143\u7D20\u7684\u5C5E\u6027\u952E\u503C\u5BF9\n\t * @param children \u5143\u7D20\u7684\u5B50\u5143\u7D20\uFF0C\u6309\u987A\u5E8F\u6DFB\u52A0\n\t * @returns\n\t */\n\t// rome-ignore lint/suspicious/noExplicitAny: \u5C5E\u6027\u968F\u610F\n\texport function dom(tag: string, settings: any, ...children: HTMLElement[]) {\n\t\tconst tmp = document.createElement(tag);\n\t\tif (settings.class) {\n\t\t\tfor (const cl of settings.class) {\n\t\t\t\ttmp.classList.add(cl);\n\t\t\t}\n\t\t\tsettings.class = undefined;\n\t\t}\n\n\t\tif (settings.style) {\n\t\t\tfor (const cl in settings.style) {\n\t\t\t\ttmp.style[cl] = settings.style[cl];\n\t\t\t}\n\t\t\tsettings.style = undefined;\n\t\t}\n\n\t\tfor (const v in settings) {\n\t\t\tif (settings[v]) tmp[v] = settings[v];\n\t\t}\n\n\t\tfor (const child of children) {\n\t\t\tif (child) tmp.appendChild(child);\n\t\t}\n\t\treturn tmp;\n\t}\n}\n", "import { utils } from \"./utils\";\n\nfunction initNCMReact() {\n\tif (\"React\" in window) {\n\t\tif (\"createElement\" in React && \"Fragment\" in React) {\n\t\t\twindow.h = React.createElement;\n\t\t\twindow.f = React.Fragment;\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn \"h\" in window && \"f\" in window;\n}\n\nutils.waitForFunction(initNCMReact, 100);\n", "export const betterncmFetch = (\n\trelPath: string,\n\toption?: RequestInit & {\n\t\tignoreApiKey?: boolean;\n\t},\n) => {\n\tif (option) {\n\t\toption.headers = option.headers ?? {};\n\t\tif (!option.ignoreApiKey)\n\t\t\toption.headers[\"BETTERNCM_API_KEY\"] = BETTERNCM_API_KEY;\n\t} else {\n\t\toption = {\n\t\t\theaders: { BETTERNCM_API_KEY },\n\t\t};\n\t}\n\treturn fetch(BETTERNCM_API_PATH + relPath, option);\n};\n\nnamespace uid {\n\tlet IDX = 256;\n\tconst HEX: string[] = [];\n\tconst SIZE = 256;\n\tlet BUFFER: string;\n\twhile (IDX--) HEX[IDX] = (IDX + 256).toString(16).substring(1);\n\n\texport function uid(len: number) {\n\t\tlet i = 0;\n\t\tlet tmp = len || 11;\n\t\tif (!BUFFER || IDX + tmp > SIZE * 2) {\n\t\t\tfor (BUFFER = \"\", IDX = 0; i < SIZE; i++) {\n\t\t\t\tBUFFER += HEX[(Math.random() * 256) | 0];\n\t\t\t}\n\t\t}\n\n\t\treturn BUFFER.substring(IDX, IDX++ + tmp);\n\t}\n}\n\n// rome-ignore lint/suspicious/noExplicitAny: <explanation>\ninterface WebKitMessage<Args extends any[]> {\n\ttype: string;\n\targuments: Args;\n\treturnId: string;\n}\n\ninterface WebKitResult<T> {\n\terror?: string;\n\tresult: string;\n}\n\n// rome-ignore lint/suspicious/noExplicitAny: <explanation>\nexport function webkitPostMessage<Args extends any[], R = undefined>(\n\tcallType: string,\n\t...args: Args\n): Promise<R> {\n\tif (APP_CONF.isOSX) {\n\t\twindow.betterncmBridgeCallbacks ??= new Map<string, Function>();\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst id = uid.uid(32);\n\t\t\tbetterncmBridgeCallbacks.set(id, (result: WebKitResult<R>) => {\n\t\t\t\tbetterncmBridgeCallbacks.delete(id);\n\t\t\t\tconsole.log(result);\n\t\t\t\tif (result) {\n\t\t\t\t\tif (result.error) {\n\t\t\t\t\t\treject(result.error);\n\t\t\t\t\t} else if (result.result.length > 0) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresolve(JSON.parse(result.result));\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(undefined as R);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treject(new TypeError(\"\u63A5\u6536\u5230\u4E86\u4E0D\u6B63\u786E\u7684\u56DE\u8C03\u4FE1\u606F\"));\n\t\t\t\t}\n\t\t\t});\n\t\t\twebkit?.messageHandlers?.BetterNCM?.postMessage<WebKitMessage<Args>>({\n\t\t\t\ttype: callType,\n\t\t\t\targuments: args,\n\t\t\t\treturnId: id,\n\t\t\t});\n\t\t});\n\t} else {\n\t\treturn Promise.reject(\n\t\t\tnew TypeError(\"\u4E0D\u53EF\u5728\u975E WebKit \u73AF\u5883\u4E0B\u53D1\u9001\u4FE1\u606F\u7ED9\u539F\u751F\u7AEF\"),\n\t\t);\n\t}\n}\n", "import { betterncmFetch, webkitPostMessage } from \"./base\";\nimport { utils } from \"./utils\";\nconst e = encodeURIComponent;\n\n/**\n * \u548C\u5916\u754C\u7684\u6587\u4EF6\u7CFB\u7EDF\u8FDB\u884C\u4EA4\u4E92\u7684\u63A5\u53E3\n */\nexport namespace fs {\n\t/**\n\t * \u5F02\u6B65\u8BFB\u53D6\u6307\u5B9A\u6587\u4EF6\u5939\u8DEF\u5F84\u4E0B\u7684\u6240\u6709\u6587\u4EF6\u548C\u6587\u4EF6\u5939\n\t * @param folderPath \u9700\u8981\u8BFB\u53D6\u7684\u6587\u4EF6\u5939\u8DEF\u5F84\n\t * @returns \u6240\u6709\u6587\u4EF6\u548C\u6587\u4EF6\u5939\u7684\u76F8\u5BF9\u8DEF\u5F84\u6216\u7EDD\u5BF9\u8DEF\u5F84\n\t */\n\texport async function readDir(folderPath: string): Promise<string[]> {\n\t\tconst r = await betterncmFetch(`/fs/read_dir?path=${e(folderPath)}`);\n\t\treturn await r.json();\n\t}\n\n\t/**\n\t * \u8BFB\u53D6\u6587\u672C\u6587\u4EF6\uFF0C\u52A1\u5FC5\u4FDD\u8BC1\u6587\u4EF6\u7F16\u7801\u662F UTF-8\n\t * @param filePath \u9700\u8981\u8BFB\u53D6\u7684\u6587\u4EF6\u8DEF\u5F84\n\t * @returns \u5BF9\u5E94\u6587\u4EF6\u7684\u6587\u672C\u5F62\u5F0F\n\t */\n\texport async function readFileText(filePath: string): Promise<string> {\n\t\tconst r = await betterncmFetch(`/fs/read_file_text?path=${e(filePath)}`);\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u8BFB\u53D6\u6587\u4EF6\n\t * @param filePath \u9700\u8981\u8BFB\u53D6\u7684\u6587\u4EF6\u8DEF\u5F84\n\t * @returns blob\n\t */\n\texport async function readFile(filePath: string): Promise<Blob> {\n\t\tconst r = await betterncmFetch(`/fs/read_file?path=${e(filePath)}`);\n\t\treturn await r.blob();\n\t}\n\n\t/**\n\t * \u6302\u8F7D\u8DEF\u5F84\n\t * @param filePath \u9700\u8981\u6302\u8F7D\u7684\u6587\u4EF6\u5939\u8DEF\u5F84\n\t * @returns \u6302\u8F7D\u5230\u7684 http \u5730\u5740\n\t */\n\texport async function mountDir(filePath: string): Promise<string> {\n\t\tconst r = await betterncmFetch(`/fs/mount_dir?path=${e(filePath)}`);\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u6302\u8F7D\u8DEF\u5F84\n\t * @param filePath \u9700\u8981\u6302\u8F7D\u7684\u6587\u4EF6\u8DEF\u5F84\n\t * @returns \u6302\u8F7D\u5230\u7684 http \u5730\u5740\n\t */\n\texport async function mountFile(filePath: string): Promise<string> {\n\t\tconst r = await betterncmFetch(`/fs/mount_file?path=${e(filePath)}`);\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u89E3\u538B\u6307\u5B9A\u7684 ZIP \u538B\u7F29\u6587\u4EF6\u5230\u4E00\u4E2A\u6307\u5B9A\u7684\u6587\u4EF6\u5939\u4E2D\n\t * @param zipPath \u9700\u8981\u89E3\u538B\u7684 ZIP \u538B\u7F29\u6587\u4EF6\u8DEF\u5F84\n\t * @param unzipDest \u9700\u8981\u89E3\u538B\u5230\u7684\u6587\u4EF6\u5939\u8DEF\u5F84\uFF0C\u5982\u679C\u4E0D\u5B58\u5728\u5219\u4F1A\u521B\u5EFA\uFF0C\u5982\u679C\u89E3\u538B\u65F6\u6709\u6587\u4EF6\u5B58\u5728\u5219\u4F1A\u88AB\u8986\u76D6\n\t * @returns \u8FD4\u56DE\u503C\uFF0C\u662F\u5426\u6210\u529F\n\t */\n\texport async function unzip(\n\t\tzipPath: string,\n\t\tunzipDest: string = `${zipPath}_extracted/`,\n\t): Promise<boolean> {\n\t\tconst r = await betterncmFetch(\n\t\t\t`/fs/unzip_file?path=${e(zipPath)}&dest=${e(unzipDest)}`,\n\t\t);\n\t\treturn parseInt(await r.text()) === 0;\n\t}\n\n\t/**\n\t * \u5C06\u6587\u672C\u5199\u5165\u5230\u6307\u5B9A\u6587\u4EF6\u5185\n\t * @param filePath \u9700\u8981\u5199\u5165\u7684\u6587\u4EF6\u8DEF\u5F84\n\t * @param content \u9700\u8981\u5199\u5165\u7684\u6587\u4EF6\u5185\u5BB9\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function writeFileText(filePath: string, content: string) {\n\t\tif (APP_CONF.isOSX) {\n\t\t\treturn await writeFile(filePath, content);\n\t\t} else {\n\t\t\tconst r = await betterncmFetch(\n\t\t\t\t`/fs/write_file_text?path=${e(filePath)}`,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: content,\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn r.status === 200;\n\t\t}\n\t}\n\n\t/**\n\t * \u5C06\u6587\u672C\u6216\u4E8C\u8FDB\u5236\u6570\u636E\u5199\u5165\u5230\u6307\u5B9A\u6587\u4EF6\u5185\n\t * @param filePath \u9700\u8981\u5199\u5165\u7684\u6587\u4EF6\u8DEF\u5F84\n\t * @param content \u9700\u8981\u5199\u5165\u7684\u6587\u4EF6\u5185\u5BB9\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function writeFile(filePath: string, content: string | Blob) {\n\t\tif (APP_CONF.isOSX) {\n\t\t\tif (typeof content === \"string\") {\n\t\t\t\tconst data = utils.escapeData(content);\n\t\t\t\treturn await webkitPostMessage(\"/fs/write_file\", filePath, data);\n\t\t\t} else {\n\t\t\t\tconst rawData = await content.arrayBuffer();\n\t\t\t\tconst data = utils.escapeData(rawData);\n\t\t\t\treturn await webkitPostMessage(\"/fs/write_file\", filePath, data);\n\t\t\t}\n\t\t} else {\n\t\t\tconst fd = new FormData();\n\t\t\tfd.append(\"file\", content);\n\t\t\tconst r = await betterncmFetch(`/fs/write_file?path=${e(filePath)}`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: fd,\n\t\t\t});\n\t\t\treturn r.status === 200;\n\t\t}\n\t}\n\n\t/**\n\t * \u5728\u6307\u5B9A\u8DEF\u5F84\u65B0\u5EFA\u6587\u4EF6\u5939\n\t * @param dirPath \u6587\u4EF6\u5939\u7684\u8DEF\u5F84\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function mkdir(dirPath: string) {\n\t\tconst r = await betterncmFetch(`/fs/mkdir?path=${e(dirPath)}`);\n\t\treturn r.status === 200;\n\t}\n\n\t/**\n\t * \u68C0\u67E5\u6307\u5B9A\u8DEF\u5F84\u4E0B\u662F\u5426\u5B58\u5728\u6587\u4EF6\u6216\u6587\u4EF6\u5939\n\t * @param path \u6587\u4EF6\u6216\u6587\u4EF6\u5939\u7684\u8DEF\u5F84\n\t * @returns \u662F\u5426\u5B58\u5728\n\t */\n\texport async function exists(path: string): Promise<boolean> {\n\t\tconst r = await betterncmFetch(`/fs/exists?path=${e(path)}`);\n\t\treturn await r.json();\n\t}\n\n\t/**\n\t * \u5220\u9664\u6307\u5B9A\u8DEF\u5F84\u4E0B\u7684\u6587\u4EF6\u6216\u6587\u4EF6\u5939\n\t * @param path \u6307\u5B9A\u7684\u6587\u4EF6\u6216\u6587\u4EF6\u5939\u8DEF\u5F84\n\t */\n\texport async function remove(path: string) {\n\t\tconst r = await betterncmFetch(`/fs/remove?path=${e(path)}`);\n\t\treturn r.status === 200;\n\t}\n}\n", "import { betterncmFetch, webkitPostMessage } from \"./base\";\n\nconst e = encodeURIComponent;\n\nexport namespace app {\n\t/**\n\t * \u6267\u884C\u6307\u5B9A\u7684\u7A0B\u5E8F\n\t * @param cmd \u9700\u8981\u6267\u884C\u7684\u6307\u4EE4\n\t * @param elevate \u662F\u5426\u4F7F\u7528\u7BA1\u7406\u5458\u6743\u9650\u8FD0\u884C\n\t * @param showWindow \u662F\u5426\u663E\u793A\u63A7\u5236\u53F0\u7A97\u53E3\n\t * @returns TODO: \u8FD4\u56DE\u7684\u5565\u73A9\u610F\n\t */\n\texport async function exec(cmd: string, elevate = false, showWindow = false) {\n\t\tconst r = await betterncmFetch(\n\t\t\t`/app/exec${elevate ? \"_ele\" : \"\"}${showWindow ? \"?_showWindow\" : \"\"}`,\n\t\t\t{ method: \"POST\", body: cmd },\n\t\t);\n\t\treturn r.status === 200;\n\t}\n\n\tlet betterNCMVersion: string | null = null;\n\n\t/**\n\t * \u83B7\u53D6\u5F53\u524D BetterNCM \u7684\u7248\u672C\u53F7\n\t * @returns \u5F53\u524D BetterNCM \u7684\u7248\u672C\u53F7\n\t */\n\texport async function getBetterNCMVersion(): Promise<string> {\n\t\tif (betterNCMVersion === null) {\n\t\t\tconst r = await betterncmFetch(\"/app/version\");\n\t\t\tbetterNCMVersion = await r.text();\n\t\t}\n\n\t\treturn betterNCMVersion;\n\t}\n\n\t/**\n\t * \u5168\u5C4F\u622A\u56FE\n\t * @returns \u622A\u56FE\u7684 Blob \u6570\u636E\n\t */\n\texport async function takeBackgroundScreenshot(): Promise<Blob> {\n\t\tconst r = await betterncmFetch(\"/app/bg_screenshot\");\n\t\treturn await r.blob();\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u7F51\u6613\u4E91\u7A97\u53E3\u4F4D\u7F6E\n\t * @returns \u4F4D\u7F6E\n\t */\n\texport async function getNCMWinPos(): Promise<{ x: number; y: number }> {\n\t\tconst r = await betterncmFetch(\"/app/get_win_position\", {\n\t\t\tignoreApiKey: true,\n\t\t});\n\t\treturn await r.json();\n\t}\n\n\t/**\n\t * \u91CD\u65B0\u89E3\u538B\u6240\u6709\u63D2\u4EF6\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function reloadPlugins() {\n\t\tconst r = await betterncmFetch(\"/app/reload_plugin\");\n\t\treturn r.status === 200;\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u76EE\u524D BetterNCM \u6570\u636E\u76EE\u5F55\n\t * @returns \u6570\u636E\u76EE\u5F55\u8DEF\u5F84\n\t */\n\texport async function getDataPath() {\n\t\tconst r = await betterncmFetch(\"/app/datapath\");\n\t\tconst p = await r.text();\n\t\treturn p.replace(/\\//g, \"\\\\\");\n\t}\n\n\t/**\n\t * \u8BFB\u53D6 BetterNCM \u8BBE\u7F6E\n\t * @param key \u952E\n\t * @param defaultValue \u9ED8\u8BA4\u503C\n\t * @returns \u8BFB\u53D6\u5230\u7684\u503C\n\t */\n\texport async function readConfig(key: string, defaultValue: string) {\n\t\tconst r = await betterncmFetch(\n\t\t\t`/app/read_config?key=${e(key)}&default=${e(defaultValue)}`,\n\t\t);\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u8BBE\u7F6E BetterNCM \u8BBE\u7F6E\n\t * @param key \u952E\n\t * @param value \u503C\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function writeConfig(key: string, value: string) {\n\t\tconst r = await betterncmFetch(\n\t\t\t`/app/write_config?key=${e(key)}&value=${e(value)}`,\n\t\t);\n\t\treturn (await r.status) === 200;\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u7F51\u6613\u4E91\u5B89\u88C5\u76EE\u5F55\n\t * @returns \u5B89\u88C5\u76EE\u5F55\n\t */\n\texport async function getNCMPath() {\n\t\tconst r = await betterncmFetch(\"/app/ncmpath\");\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u6253\u5F00\u7F51\u6613\u4E91\u4E3B\u8FDB\u7A0B\u7684Console\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function showConsole() {\n\t\tif (APP_CONF.isOSX) {\n\t\t\treturn await webkitPostMessage(\"/app/show_console\");\n\t\t} else {\n\t\t\tconst r = await betterncmFetch(\"/app/show_console\");\n\t\t\treturn r.status === 200;\n\t\t}\n\t}\n\n\t/**\n\t * \u8BBE\u7F6EWin11 DWM\u5706\u89D2\u5F00\u542F\u72B6\u6001\n\t * @param enable \u662F\u5426\u5F00\u542F\n\t * @returns \u662F\u5426\u6210\u529F\n\t */\n\texport async function setRoundedCorner(enable = true) {\n\t\tconst r = await betterncmFetch(`/app/set_rounded_corner?enable=${enable}`);\n\t\treturn r.status === 200;\n\t}\n\n\t/**\n\t * \u6253\u5F00\u4E00\u4E2A\u9009\u62E9\u6587\u4EF6\u5BF9\u8BDD\u6846\n\t * @param filter \u8981\u7B5B\u9009\u7684\u6587\u4EF6\u7C7B\u578B\n\t * @param initialDir \u5BF9\u8BDD\u6846\u521D\u59CB\u5730\u5740\n\t * @returns \u9009\u62E9\u7684\u6587\u4EF6\u5730\u5740\uFF0C\u82E5\u672A\u9009\u62E9\u5219\u4E3A\u7A7A\u5B57\u7B26\u4E32\n\t */\n\texport async function openFileDialog(\n\t\tfilter: string,\n\t\tinitialDir: string,\n\t): Promise<string> {\n\t\tconst r = await betterncmFetch(\n\t\t\t`/app/open_file_dialog?filter=${e(filter)}&initialDir=${e(initialDir)}`,\n\t\t);\n\t\treturn await r.text();\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u5F53\u524D\u4E3B\u9898\u662F\u5426\u4E3A\u4EAE\u8272\u4E3B\u9898\n\t * @todo \u6D4B\u8BD5\u5728 Windows 7 \u53CA Windows 10 \u4E0B\u662F\u5426\u6B63\u5E38\u5DE5\u4F5C\n\t * @returns \u5F53\u524D\u4E3B\u9898\u662F\u5426\u4E3A\u4EAE\u8272\u4E3B\u9898\n\t */\n\texport async function isLightTheme() {\n\t\tconst r = await betterncmFetch(\"/app/is_light_theme\");\n\t\treturn await r.json();\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u6267\u884C\u6210\u529F\u7684 Hijack \u65E5\u5FD7\n\t * @returns Hijack \u65E5\u5FD7\n\t */\n\texport async function getSucceededHijacks(): Promise<string[]> {\n\t\tconst r = await betterncmFetch(\"/app/get_succeeded_hijacks\");\n\t\treturn await r.json();\n\t}\n}\n", "const cachedFunctionMap: Map<string, Function> = new Map();\n\n// rome-ignore lint/suspicious/noExplicitAny: \u51FD\u6570\u7C7B\u578B\u53EF\u968F\u610F\nfunction callCachedSearchFunction<F extends (...args: any[]) => any>(\n\tsearchFunctionName: string,\n\targs: Parameters<F>,\n): ReturnType<F> {\n\tif (!cachedFunctionMap.has(searchFunctionName)) {\n\t\tconst findResult = ncm.findApiFunction(searchFunctionName);\n\t\tif (findResult) {\n\t\t\tconst [func, funcRoot] = findResult;\n\t\t\tcachedFunctionMap.set(searchFunctionName, func.bind(funcRoot));\n\t\t}\n\t}\n\tconst cachedFunc = cachedFunctionMap.get(searchFunctionName);\n\tif (cachedFunc) {\n\t\treturn cachedFunc.apply(null, args);\n\t} else {\n\t\tthrow new TypeError(`\u51FD\u6570 ${searchFunctionName} \u672A\u627E\u5230`);\n\t}\n}\n\nexport namespace ncm {\n\texport function findNativeFunction(obj: Object, identifiers: string) {\n\t\tfor (let key in obj) {\n\t\t\tlet flag = true;\n\t\t\tfor (\n\t\t\t\tlet _i = 0, identifiers_1 = identifiers;\n\t\t\t\t_i < identifiers_1.length;\n\t\t\t\t_i++\n\t\t\t) {\n\t\t\t\tlet identifier = identifiers_1[_i];\n\t\t\t\tif (!obj[key].toString().includes(identifier)) flag = false;\n\t\t\t}\n\t\t\tif (flag) return key;\n\t\t}\n\t}\n\n\texport function openUrl(url: string) {\n\t\twindow.legacyNativeCmder._envAdapter.callAdapter(\n\t\t\t\"os.navigateExternal\",\n\t\t\t[url],\n\t\t\t() => {},\n\t\t);\n\t}\n\n\texport function getNCMPackageVersion(): string {\n\t\treturn window?.APP_CONF?.packageVersion || \"0000000\";\n\t}\n\n\texport function getNCMFullVersion(): string {\n\t\treturn window?.APP_CONF?.appver || \"0.0.0.0\";\n\t}\n\n\texport function getNCMVersion(): string {\n\t\tconst v = getNCMFullVersion();\n\t\treturn v.substring(0, v.lastIndexOf(\".\"));\n\t}\n\n\texport function getNCMBuild(): number {\n\t\tconst v = getNCMFullVersion();\n\t\treturn parseInt(v.substring(v.lastIndexOf(\".\") + 1));\n\t}\n\t\n\tconst waitTick = () => new Promise(resolve => requestAnimationFrame(resolve))\n\n\texport function searchApiFunction(\n\t\tnameOrFinder: string | ((func: Function) => boolean),\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u6839\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\troot: any = window,\n\t\tcurrentPath = [\"window\"],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u5DF2\u68C0\u7D22\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\tprevObjects: any[] = [],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD4\u56DE\u8BE5\u51FD\u6570\u7684\u643A\u5E26\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u505A bind \u7ED1\u5B9A\n\t\tresult: [Function, any, string[]][] = [],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD4\u56DE\u8BE5\u51FD\u6570\u7684\u643A\u5E26\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u505A bind \u7ED1\u5B9A\n\t): [Function, any, string[]][] {\n\t\tif (root === undefined || root === null) {\n\t\t\treturn result;\n\t\t}\n\t\tprevObjects.push(root);\n\t\tif (typeof nameOrFinder === \"string\") {\n\t\t\tif (typeof root[nameOrFinder] === \"function\") {\n\t\t\t\tresult.push([root[nameOrFinder], root, [...currentPath, nameOrFinder]]);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const key of Object.getOwnPropertyNames(root)) {\n\t\t\t\tif (typeof root[key] === \"function\" && Object.hasOwn(root, key)) {\n\t\t\t\t\tconsole.log(`${currentPath.join(\".\")}.${key}`);\n\t\t\t\t\tif (nameOrFinder(root[key])) {\n\t\t\t\t\t\tresult.push([root[key], root, [...currentPath, key]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (currentPath.length < 10) {\n\t\t\tfor (const key of Object.getOwnPropertyNames(root)) {\n\t\t\t\tif (\n\t\t\t\t\ttypeof root[key] === \"object\" &&\n\t\t\t\t\tObject.hasOwn(root, key) &&\n\t\t\t\t\t!prevObjects.includes(root[key]) &&\n\t\t\t\t\t!(\n\t\t\t\t\t\tcurrentPath.length === 1 &&\n\t\t\t\t\t\tprevObjects[prevObjects.length - 1] === window &&\n\t\t\t\t\t\tkey === \"betterncm\"\n\t\t\t\t\t) // \u54B1\u4EEC\u81EA\u5DF1\u7684\u51FD\u6570\u5C31\u4E0D\u9700\u8981\u68C0\u6D4B\u4E86\n\t\t\t\t) {\n\t\t\t\t\tcurrentPath.push(key);\n\t\t\t\t\tsearchApiFunction(\n\t\t\t\t\t\tnameOrFinder,\n\t\t\t\t\t\troot[key],\n\t\t\t\t\t\tcurrentPath,\n\t\t\t\t\t\tprevObjects,\n\t\t\t\t\t\tresult,\n\t\t\t\t\t);\n\t\t\t\t\tcurrentPath.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprevObjects.pop();\n\t\treturn result;\n\t}\n\n\texport function searchForData(\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u4F1A\u68C0\u6D4B\u4EFB\u610F\u503C\n\t\tfinder: (func: any) => boolean,\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u6839\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\troot: any = window,\n\t\tcurrentPath = [\"window\"],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u5DF2\u68C0\u7D22\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\tprevObjects: any[] = [],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD4\u56DE\u8BE5\u51FD\u6570\u7684\u643A\u5E26\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u505A bind \u7ED1\u5B9A\n\t\tresult: [any, any, string[]][] = [],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD4\u56DE\u8BE5\u51FD\u6570\u7684\u643A\u5E26\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u505A bind \u7ED1\u5B9A\n\t): [any, any, string[]][] {\n\t\tif (root === undefined || root === null) {\n\t\t\treturn [];\n\t\t}\n\t\tprevObjects.push(root);\n\t\tif (currentPath.length < 10) {\n\t\t\tfor (const key of Object.keys(root)) {\n\t\t\t\tif (\n\t\t\t\t\tObject.hasOwnProperty.call(root, key) &&\n\t\t\t\t\t!prevObjects.includes(root[key]) &&\n\t\t\t\t\t!(\n\t\t\t\t\t\tcurrentPath.length === 1 &&\n\t\t\t\t\t\tprevObjects[prevObjects.length - 1] === window &&\n\t\t\t\t\t\tkey === \"betterncm\"\n\t\t\t\t\t) // \u54B1\u4EEC\u81EA\u5DF1\u7684\u51FD\u6570\u5C31\u4E0D\u9700\u8981\u68C0\u6D4B\u4E86\n\t\t\t\t) {\n\t\t\t\t\tif (typeof root[key] === \"object\") {\n\t\t\t\t\t\tcurrentPath.push(key);\n\t\t\t\t\t\tsearchApiFunction(\n\t\t\t\t\t\t\tfinder,\n\t\t\t\t\t\t\troot[key],\n\t\t\t\t\t\t\tcurrentPath,\n\t\t\t\t\t\t\tprevObjects,\n\t\t\t\t\t\t\tresult,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcurrentPath.pop();\n\t\t\t\t\t} else if (finder(root[key])) {\n\t\t\t\t\t\tresult.push([root[key], root, [...currentPath]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprevObjects.pop();\n\t\treturn result;\n\t}\n\n\texport function findApiFunction(\n\t\tnameOrFinder: string | ((func: Function) => boolean),\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u6839\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\troot: any = window,\n\t\tcurrentPath = [\"window\"],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u5DF2\u68C0\u7D22\u5BF9\u8C61\u53EF\u4EE5\u662F\u4EFB\u610F\u7684\n\t\tprevObjects: any[] = [],\n\t\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD4\u56DE\u8BE5\u51FD\u6570\u7684\u643A\u5E26\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u505A bind \u7ED1\u5B9A\n\t): [Function, any, string[]] | null {\n\t\tif (root === undefined || root === null) {\n\t\t\treturn null;\n\t\t}\n\t\tprevObjects.push(root);\n\t\tif (typeof nameOrFinder === \"string\") {\n\t\t\tif (typeof root[nameOrFinder] === \"function\") {\n\t\t\t\treturn [root[nameOrFinder], root, [...currentPath]];\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const key of Object.keys(root)) {\n\t\t\t\tif (\n\t\t\t\t\tObject.hasOwnProperty.call(root, key) &&\n\t\t\t\t\ttypeof root[key] === \"function\" &&\n\t\t\t\t\tnameOrFinder(root[key])\n\t\t\t\t) {\n\t\t\t\t\treturn [root[key], root, [...currentPath]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (currentPath.length < 10) {\n\t\t\tfor (const key of Object.keys(root)) {\n\t\t\t\tif (\n\t\t\t\t\tObject.hasOwnProperty.call(root, key) &&\n\t\t\t\t\ttypeof root[key] === \"object\" &&\n\t\t\t\t\t!prevObjects.includes(root[key]) &&\n\t\t\t\t\t!(\n\t\t\t\t\t\tcurrentPath.length === 1 &&\n\t\t\t\t\t\tprevObjects[prevObjects.length - 1] === window &&\n\t\t\t\t\t\tkey === \"betterncm\"\n\t\t\t\t\t) // \u54B1\u4EEC\u81EA\u5DF1\u7684\u51FD\u6570\u5C31\u4E0D\u9700\u8981\u68C0\u6D4B\u4E86\n\t\t\t\t) {\n\t\t\t\t\tcurrentPath.push(key);\n\t\t\t\t\tconst result = findApiFunction(\n\t\t\t\t\t\tnameOrFinder,\n\t\t\t\t\t\troot[key],\n\t\t\t\t\t\tcurrentPath,\n\t\t\t\t\t\tprevObjects,\n\t\t\t\t\t);\n\t\t\t\t\tcurrentPath.pop();\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprevObjects.pop();\n\t\treturn null;\n\t}\n\n\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD9\u4E2A\u662F\u7F51\u6613\u4E91\u81EA\u5DF1\u66B4\u9732\u7684\u5BF9\u8C61\uFF0C\u91CC\u5934\u6709\u5F88\u591A\u53EF\u4EE5\u5229\u7528\u7684\u51FD\u6570\n\tdeclare const dc: any;\n\t// rome-ignore lint/suspicious/noExplicitAny: \u8FD9\u4E2A\u662F\u7F51\u6613\u4E91\u81EA\u5DF1\u66B4\u9732\u7684\u5BF9\u8C61\uFF0C\u91CC\u5934\u6709\u5F88\u591A\u53EF\u4EE5\u5229\u7528\u7684\u51FD\u6570\n\tdeclare const ctl: any;\n\n\tlet cachedGetPlayingFunc: Function | null = null;\n\t/**\n\t * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u64AD\u653E\u7684\u6B4C\u66F2\u7684\u4FE1\u606F\uFF0C\u5305\u62EC\u6B4C\u66F2\u4FE1\u606F\uFF0C\u6765\u6E90\uFF0C\u5F53\u524D\u64AD\u653E\u72B6\u6001\u7B49\n\t * @todo \u8865\u5168\u8FD4\u56DE\u503C\u7C7B\u578B\n\t * @returns \u5F53\u524D\u6B4C\u66F2\u7684\u64AD\u653E\u4FE1\u606F\n\t */\n\texport function getPlayingSong() {\n\t\tif (cachedGetPlayingFunc === null) {\n\t\t\tconst findResult = findApiFunction(\"getPlaying\");\n\t\t\tif (findResult) {\n\t\t\t\tconst [getPlaying, getPlayingRoot] = findResult;\n\t\t\t\tcachedGetPlayingFunc = getPlaying.bind(getPlayingRoot);\n\t\t\t}\n\t\t}\n\t\tif (cachedGetPlayingFunc === null) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn cachedGetPlayingFunc();\n\t\t}\n\t}\n\n\t/**\n\t * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u64AD\u653E\u7684\u6B4C\u66F2\u7684\u7B80\u8981\u4FE1\u606F\n\t * @deprecated \u7531\u4E8E\u627E\u5230\u4E86\u81EA\u5E26\u7684\u63A5\u53E3\uFF0C\u6545\u8FD9\u4E2A\u51FD\u6570\u88AB\u5F03\u7528\uFF0C\u8BF7\u8F6C\u800C\u4F7F\u7528 `betterncm.ncm.getPlayingSong`\n\t * @returns \u7B80\u5316\u7684\u64AD\u653E\u4FE1\u606F\n\t */\n\texport function getPlaying() {\n\t\tconst playing = getPlayingSong();\n\t\tconst result = {\n\t\t\tid: playing.data.id as number,\n\t\t\ttitle: playing.data.name as string,\n\t\t\ttype: \"normal\",\n\t\t};\n\t\tif (playing.from.fm) {\n\t\t\tresult.type = \"fm\";\n\t\t}\n\t\treturn result;\n\t}\n}\n", "import { fs } from \"./fs\";\n\nexport namespace tests {\n\texport async function fail(reason: string) {\n\t\tconsole.warn(\"Test Failed\", reason);\n\t\tawait fs.writeFileText(\"/__TEST_FAILED__.txt\", reason);\n\t}\n\n\texport async function success(message: string) {\n\t\tconsole.warn(\"Test Succeeded\", message);\n\t\tawait fs.writeFileText(\"/__TEST_SUCCEEDED__.txt\", message);\n\t}\n}\n", "/**\n * @fileoverview\n * BetterNCM \u63D2\u4EF6\u5F00\u53D1\u63A5\u53E3\n *\n * \u63D2\u4EF6\u4F5C\u8005\u53EF\u4EE5\u901A\u8FC7\u6B64\u5904\u7684\u63A5\u53E3\u6765\u548C\u754C\u9762\u6216\u7A0B\u5E8F\u5916\u90E8\u4EA4\u4E92\n */\n\nimport \"./react\";\nimport { fs } from \"./fs\";\nimport { app } from \"./app\";\nimport { ncm } from \"./ncm\";\nimport { tests } from \"./tests\";\nimport { utils } from \"./utils\";\nimport { betterncmFetch } from \"./base\";\n\ndeclare const loadingMask: HTMLDivElement;\n/**\n * \u5305\u542B\u52A0\u8F7D\u52A8\u753B\u7684\u91CD\u8F7D\n */\nfunction reload(): void {\n\tif (!(\"loadingMask\" in window)) {\n\t\tdocument.location.reload();\n\t\treturn;\n\t}\n\tconst anim = loadingMask.animate([{ opacity: 0 }, { opacity: 1 }], {\n\t\tduration: 300,\n\t\tfill: \"forwards\",\n\t\teasing: \"cubic-bezier(0.42, 0, 0.58, 1)\",\n\t});\n\tanim.commitStyles();\n\n\tanim.addEventListener(\"finish\", (_) => {\n\t\tdocument.location.reload();\n\t});\n}\n\nconst BetterNCM = {\n\tfs,\n\tapp,\n\tncm,\n\tutils,\n\ttests,\n\treload,\n\tbetterncmFetch,\n};\n\nexport { fs, app, ncm, utils, tests, reload };\n\nwindow.dom = utils.dom;\n\ndeclare let betterncm: typeof BetterNCM;\nbetterncm = BetterNCM;\nexport default BetterNCM;\n", "export const Button: React.FC<\n\tReact.PropsWithChildren<React.HTMLAttributes<HTMLAnchorElement>>\n> = (props) => {\n\tconst { children, className, ...other } = props;\n\treturn (\n\t\t<a className={`u-ibtn5 bncm-btn u-ibtnsz8 ${className || \"\"}`} {...other}>\n\t\t\t{children}\n\t\t</a>\n\t);\n};\n", "export const ProgressRing: React.FC<{\n\tsize?: string;\n}> = (props) => {\n\treturn (\n\t\t<span\n\t\t\tclassName=\"bncm-spinner\"\n\t\t\tstyle={{\n\t\t\t\twidth: props.size || \"16px\",\n\t\t\t\theight: props.size || \"16px\",\n\t\t\t}}\n\t\t>\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t\t<div />\n\t\t</span>\n\t);\n};\n", "import BetterNCM from \"../../betterncm-api\";\nimport { disableSafeMode, isSafeMode } from \"../../loader\";\nimport { Button } from \"./button\";\nimport { ProgressRing } from \"./progress-ring\";\n\ninterface ReleaseVersion {\n\tversion: string;\n\tsupports: string[];\n\tfile: string;\n\tchangelog: string;\n}\n\ninterface OnlineVersionInfo {\n\tversions: ReleaseVersion[];\n}\n\nexport const HeaderComponent: React.FC<{\n\tonRequestOpenStartupWarnings: Function;\n}> = (props) => {\n\tconst [updateButtonColor, setUpdateButtonColor] =\n\t\tReact.useState(\"transparent\"); // #F004 #0F04\n\n\tconst safeMode = React.useMemo(() => isSafeMode(), undefined);\n\n\tconst [latestVersion, setLatestVersion] =\n\t\tReact.useState<ReleaseVersion | null>(null);\n\n\tconst [currentVersion, setCurrentVersion] = React.useState(\"\");\n\n\tReact.useEffect(() => {\n\t\t(async () => {\n\t\t\tif (!latestVersion) {\n\t\t\t\tconst betterNCMVersion = await BetterNCM.app.getBetterNCMVersion();\n\t\t\t\tsetCurrentVersion(betterNCMVersion);\n\t\t\t\tconst currentNCMVersion = BetterNCM.ncm.getNCMVersion();\n\n\t\t\t\tconst online: OnlineVersionInfo = await (\n\t\t\t\t\tawait fetch(\n\t\t\t\t\t\t\"https://gitee.com/microblock/better-ncm-v2-data/raw/master/betterncm/betterncm.json\",\n\t\t\t\t\t)\n\t\t\t\t).json();\n\t\t\t\tconst onlineSuitableVersions = online.versions.filter((v) =>\n\t\t\t\t\tv.supports.includes(currentNCMVersion),\n\t\t\t\t);\n\t\t\t\tif (onlineSuitableVersions.length === 0) {\n\t\t\t\t\tsetUpdateButtonColor(\"#F004\");\n\t\t\t\t\tsetLatestVersion({\n\t\t\t\t\t\tversion: \"\",\n\t\t\t\t\t\tsupports: [],\n\t\t\t\t\t\tfile: \"\",\n\t\t\t\t\t\tchangelog: \"\",\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst latestVersion = onlineSuitableVersions[0];\n\t\t\t\t\tif (latestVersion.version !== betterNCMVersion) {\n\t\t\t\t\t\tsetUpdateButtonColor(\"#0F04\");\n\t\t\t\t\t}\n\t\t\t\t\tsetLatestVersion(latestVersion);\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t}, [latestVersion]);\n\n\tconst onUpdateButtonClicked = React.useCallback(async () => {\n\t\tif (latestVersion && latestVersion.version !== currentVersion) {\n\t\t\tconst ncmpath = await BetterNCM.app.getNCMPath();\n\t\t\tconst datapath = await BetterNCM.app.getDataPath();\n\t\t\tconst dllpath = `${datapath}\\\\betterncm.dll`;\n\t\t\tif (await BetterNCM.fs.exists(\"./betterncm.dll\"))\n\t\t\t\tawait BetterNCM.fs.remove(\"./betterncm.dll\");\n\n\t\t\tawait BetterNCM.fs.writeFile(\n\t\t\t\t\"./betterncm.dll\",\n\t\t\t\tawait (await fetch(latestVersion?.file)).blob(),\n\t\t\t);\n\n\t\t\tif (!ncmpath.toLowerCase().includes(\"system\")) {\n\t\t\t\tBetterNCM.app.exec(\n\t\t\t\t\t[\n\t\t\t\t\t\t\"cmd /c @echo off\",\n\t\t\t\t\t\t\"echo BetterNCM Updating...\",\n\t\t\t\t\t\t\"cd /d C:/\",\n\t\t\t\t\t\t\"cd C:/\",\n\t\t\t\t\t\t`cd /d ${ncmpath[0]}:/`,\n\t\t\t\t\t\t`cd \"${ncmpath}\"`,\n\t\t\t\t\t\t\"taskkill /f /im cloudmusic.exe>nul\",\n\t\t\t\t\t\t\"taskkill /f /im cloudmusicn.exe>nul\",\n\t\t\t\t\t\t\"ping 127.0.0.1>nul & del msimg32.dll\",\n\t\t\t\t\t\t`move \"${dllpath}\" .\\\\msimg32.dll`,\n\t\t\t\t\t\t\"start cloudmusic.exe\",\n\t\t\t\t\t].join(\" & \"),\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (latestVersion) {\n\t\t\t// \u91CD\u65B0\u68C0\u6D4B\u65B0\u7248\u672C\n\t\t\tsetLatestVersion(null);\n\t\t}\n\t}, [latestVersion]);\n\n\treturn (\n\t\t<section className=\"bncm-mgr-header\">\n\t\t\t<img\n\t\t\t\tsrc=\"https://s1.ax1x.com/2022/08/11/vGlJN8.png\"\n\t\t\t\talt=\"\"\n\t\t\t\tstyle={{\n\t\t\t\t\theight: \"64px\",\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<div>\n\t\t\t\t<h1>\n\t\t\t\t\tBetterNCM\n\t\t\t\t\t<span\n\t\t\t\t\t\tstyle={{ fontSize: \"smaller\", opacity: \"0.8\", marginLeft: \"1rem\" }}\n\t\t\t\t\t>\n\t\t\t\t\t\t{currentVersion}\n\t\t\t\t\t</span>\n\t\t\t\t</h1>\n\t\t\t\t<div className=\"bncm-mgr-btns\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\tBetterNCM.app.exec(\n\t\t\t\t\t\t\t\t`explorer \"${(await BetterNCM.app.getDataPath()).replace(\n\t\t\t\t\t\t\t\t\t/\\//g,\n\t\t\t\t\t\t\t\t\t\"\\\\\",\n\t\t\t\t\t\t\t\t)}\"`,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t\u6253\u5F00\u63D2\u4EF6\u6587\u4EF6\u5939\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\tawait disableSafeMode();\n\t\t\t\t\t\t\tawait BetterNCM.app.reloadPlugins();\n\t\t\t\t\t\t\tBetterNCM.reload();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t\u91CD\u8F7D\u63D2\u4EF6\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\t\t\tbackground: updateButtonColor,\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonClick={onUpdateButtonClicked}\n\t\t\t\t\t>\n\t\t\t\t\t\t{latestVersion === null ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ProgressRing />\n\t\t\t\t\t\t\t\t\u68C0\u67E5\u66F4\u65B0\u4E2D\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : latestVersion.version === currentVersion ? (\n\t\t\t\t\t\t\t<>\u5DF2\u662F\u6700\u65B0\u7248\u672C</>\n\t\t\t\t\t\t) : latestVersion.version.length === 0 ? (\n\t\t\t\t\t\t\t<>\u7248\u672C\u4E0D\u517C\u5BB9</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\u70B9\u51FB\u66F4\u65B0\u5230 {latestVersion.version}</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"m-tool\">\n\t\t\t\t<a\n\t\t\t\t\tclassName=\"itm\"\n\t\t\t\t\t// rome-ignore lint/a11y/useValidAnchor: <explanation>\n\t\t\t\t\tonClick={() => props.onRequestOpenStartupWarnings()}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: \"32px\",\n\t\t\t\t\t\theight: \"32px\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<svg width=\"32px\" height=\"32px\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\td=\"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t\t<a\n\t\t\t\t\tclassName=\"itm\"\n\t\t\t\t\t// rome-ignore lint/a11y/useValidAnchor: <explanation>\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\tBetterNCM.ncm.openUrl(\"https://github.com/MicroCBer/BetterNCM\")\n\t\t\t\t\t}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: \"32px\",\n\t\t\t\t\t\theight: \"32px\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<svg width=\"32px\" height=\"32px\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\td=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</section>\n\t);\n};\n", "import { getLoadError } from \"../../loader\";\n\nexport const SafeModeInfo: React.FC = () => {\n\tconst loadError = React.useMemo(getLoadError, []);\n\n\treturn (\n\t\t<div className=\"v-scroll\">\n\t\t\t<div>\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\toverflowY: \"scroll\",\n\t\t\t\t\t\toverflowX: \"hidden\",\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"safe-mode-info\"\n\t\t\t\t>\n\t\t\t\t\t<h1>\u73B0\u5728\u5904\u4E8E\u5B89\u5168\u6A21\u5F0F</h1>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tBetterNCM\n\t\t\t\t\t\t\u63D2\u4EF6\u52A0\u8F7D\u5668\u53EF\u80FD\u906D\u9047\u4E86\u591A\u6B21\u63D2\u4EF6\u52A0\u8F7D\u5931\u8D25\u91CD\u8F7D\uFF0C\u5B89\u5168\u6A21\u5F0F\u5DF2\u81EA\u52A8\u542F\u7528\uFF0C\u5728\u8BE5\u6A21\u5F0F\u4E0B\u4E0D\u4F1A\u52A0\u8F7D\u4EFB\u4F55\u63D2\u4EF6\u3002\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t\u63D2\u4EF6\u52A0\u8F7D\u5668\u5DF2\u7ECF\u6536\u96C6\u4E86\u6BCF\u6B21\u52A0\u8F7D\u53D1\u751F\u7684\u9519\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u52A0\u8F7D\u5931\u8D25\u7684\u63D2\u4EF6\uFF0C\u5E76\u5C06\u53D1\u751F\u9519\u8BEF\u7684\u63D2\u4EF6\u624B\u52A8\u79FB\u9664\u6216\u4FEE\u6B63\u3002\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\u5B8C\u6210\u8C03\u6574\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u6309\u4E0B\u91CD\u8F7D\u63D2\u4EF6\u5173\u95ED\u5B89\u5168\u6A21\u5F0F\u5E76\u91CD\u65B0\u52A0\u8F7D\u63D2\u4EF6\u3002</p>\n\t\t\t\t\t{loadError.length === 0 ? (\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\u6CA1\u6709\u627E\u5230\u52A0\u8F7D\u9519\u8BEF\u8BB0\u5F55\uFF0C\u6709\u53EF\u80FD\u662F\u53D7\u5230\u63D2\u4EF6\u5F71\u54CD\u6216\u63D2\u4EF6\u7BA1\u7406\u5668\u81EA\u8EAB\u51FA\u9519\u3002\n\t\t\t\t\t\t</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<p>\u52A0\u8F7D\u9519\u8BEF\u8BB0\u5F55\uFF1A</p>\n\t\t\t\t\t\t\t<code>\n\t\t\t\t\t\t\t\t<pre style={{ whiteSpace: \"pre-wrap\" }}>{loadError}</pre>\n\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n", "/**\n * @fileoverview\n * \u9996\u6B21\u542F\u52A8\u4F1A\u5F39\u51FA\u7684\u514D\u8D23\u548C\u8B66\u544A\u7A97\u53E3\n *\n * \u65E0\u826F\u516C\u4F17\u53F7\u548C\u5012\u5356\u72D7\u53BB\u6B7B\u5427\n */\n\nimport BetterNCM from \"../../betterncm-api\";\n\nexport const StartupWarning: React.FC<{\n\tonRequestClose: Function;\n}> = (props) => {\n\treturn (\n\t\t<div className=\"startup-warning\">\n\t\t\t<h1>\u6B22\u8FCE\u4F7F\u7528 BetterNCM\uFF01</h1>\n\t\t\t<p>\n\t\t\t\tBetterNCM \u662F\u4E00\u4E2A\u7531\u4E00\u7FA4\u70ED\u7231\u7F51\u6613\u4E91\u97F3\u4E50\u7684\u4E91\u6751\u6751\u53CB\u5F00\u53D1\u7684 PC\n\t\t\t\t\u7248\u7F51\u6613\u4E91\u97F3\u4E50\u6269\u5C55\u5DE5\u5177\uFF0C\u53EF\u4EE5\u63D0\u4F9B\u975E\u5E38\u4E30\u5BCC\u7684\u81EA\u5B9A\u4E49\u529F\u80FD\u6269\u5C55\u589E\u5F3A\u80FD\u529B\u3002\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t\u8003\u8651\u5230\u5DE5\u5177\u6027\u8D28\uFF0CBetterNCM \u5C06<b>\u6C38\u8FDC\u662F\u5B8C\u5168\u5F00\u6E90\u514D\u8D39\u7684\u81EA\u7531\u8F6F\u4EF6</b>\n\t\t\t\t\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u662F\u4ECE\u4EFB\u4F55\u5730\u65B9\u53D1\u73B0\u6709\u4EFB\u4F55\u4EBA\u5728\u552E\u5356\u672C\u5DE5\u5177\uFF0C\u8BF7\u7ACB\u523B\u8981\u6C42\u9000\u6B3E\u5E76\u4E3E\u62A5\u5546\u5BB6\uFF01\n\t\t\t\t\u4F5C\u4E3A\u4E00\u7FA4\u7231\u597D\u8005\uFF0C\u6211\u4EEC\u4E0D\u4F1A\u4E5F\u6CA1\u529E\u6CD5\u4E3A\u4F60\u56E0\u4E3A\u4ECE\u5176\u5B83\u9014\u5F84\u8D2D\u4E70\u672C\u5DE5\u5177\u9020\u6210\u7684\u635F\u5931\u8D1F\u8D23\uFF01\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t\u5982\u679C\u4F60\u4E5F\u5E0C\u671B\u4E3A BetterNCM \u8D21\u732E\u4EE3\u7801\uFF0C\u6B22\u8FCE\u524D\u6765 BetterNCM \u7684 Github\n\t\t\t\t\u5F00\u6E90\u4ED3\u5E93\uFF1A\n\t\t\t\t<a\n\t\t\t\t\tclassName=\"itm\"\n\t\t\t\t\t// rome-ignore lint/a11y/useValidAnchor: <explanation>\n\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\tBetterNCM.ncm.openUrl(\"https://github.com/MicroCBer/BetterNCM\")\n\t\t\t\t\t}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: \"32px\",\n\t\t\t\t\t\theight: \"32px\",\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\thttps://github.com/MicroCBer/BetterNCM\n\t\t\t\t</a>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t\u901A\u8FC7\u70B9\u51FB\u53F3\u4E0A\u89D2\u7684\u7F51\u6613\u4E91\u56FE\u6807\uFF08\u5728\u8BBE\u7F6E\u56FE\u6807\u7684\u53F3\u4FA7\uFF09\u53EF\u4EE5\u6253\u5F00\u63D2\u4EF6\u7BA1\u7406\u5668\uFF0C\n\t\t\t\t\u7136\u540E\u901A\u8FC7\u63D2\u4EF6\u7BA1\u7406\u5668\u914D\u5957\u7684\u63D2\u4EF6\u5546\u5E97\uFF0C\u5C31\u53EF\u4EE5\u5B89\u88C5\u4F60\u559C\u6B22\u7684\u63D2\u4EF6\u6765\u6269\u5C55\u7F51\u6613\u4E91\u7684\u529F\u80FD\u548C\u5916\u89C2\u54E6\uFF01\n\t\t\t</p>\n\t\t\t<button onClick={() => props.onRequestClose()}>\u5F00\u59CB\u4F7F\u7528 BetterNCM</button>\n\t\t</div>\n\t);\n};\n", "import BetterNCM from \"../betterncm-api\";\nimport { isSafeMode, loadedPlugins } from \"../loader\";\nimport { NCMPlugin } from \"../plugin\";\nimport { HeaderComponent } from \"./components/header\";\nimport { SafeModeInfo } from \"./components/safe-mode-info\";\nimport { StartupWarning } from \"./components/warning\";\n\nconst OPENED_WARNINGS = \"config.betterncm.manager.openedwarnings\";\n\nexport async function initPluginManager() {\n\t// \u51C6\u5907\u8BBE\u7F6E\u9875\u9762\u548C\u8BBF\u95EE\u6309\u94AE\n\tconst settingsView = document.createElement(\"section\");\n\tconst mainPageView: HTMLElement = (await BetterNCM.utils.waitForElement(\n\t\t\"section.g-mn\",\n\t))!!;\n\tconst settingsButton = (await BetterNCM.utils.waitForElement(\n\t\t'a[href=\"#/m/setting/\"]',\n\t))!! as HTMLAnchorElement;\n\tconst betterNCMSettingsButton = settingsButton.cloneNode(\n\t\ttrue,\n\t) as HTMLAnchorElement;\n\tbetterNCMSettingsButton.href = \"javascript:void(0)\";\n\tbetterNCMSettingsButton.title = \"BetterNCM\";\n\tif (APP_CONF.isOSX) {\n\t\tbetterNCMSettingsButton.innerHTML = `<svg style='transform: scale(0.8);'><use xlink:href=\"orpheus://orpheus/style/res/svg/sidebar.sp.svg#icn-discover\"></use></svg>`;\n\t} else {\n\t\tbetterNCMSettingsButton.innerHTML = `<svg style='transform: scale(0.8);'><use xlink:href=\"orpheus://orpheus/style/res/svg/topbar.sp.svg#logo_white\"></use></svg>`;\n\t}\n\tmainPageView.parentElement!!.insertBefore(\n\t\tsettingsView,\n\t\tmainPageView.nextElementSibling,\n\t);\n\tsettingsButton.parentElement!!.insertBefore(\n\t\tbetterNCMSettingsButton,\n\t\tsettingsButton.nextElementSibling,\n\t);\n\n\tbetterNCMSettingsButton.style.scale = \"1.4\";\n\tbetterNCMSettingsButton.addEventListener(\"click\", () => {\n\t\tif (settingsView.classList.contains(\"ncmm-show\")) {\n\t\t\thideSettings();\n\t\t} else {\n\t\t\tshowSettings();\n\t\t}\n\t});\n\n\tReactDOM.render(<PluginManager />, settingsView);\n\n\tsettingsView.classList.add(\"better-ncm-manager\");\n\tsettingsView.classList.add(\"g-mn\");\n\n\tfunction showSettings() {\n\t\t// \u6709\u63D2\u4EF6\u4F3C\u4E4E\u4F1A\u66FF\u6362\u4E3B\u9875\u5143\u7D20\uFF0C\u5BFC\u81F4\u6211\u4EEC\u7684\u8BBE\u7F6E\u9875\u9762\u65E0\u6CD5\u663E\u793A\uFF0C\u9700\u8981\u8FDB\u884C\u68C0\u67E5\n\t\tif (settingsView.parentElement !== mainPageView.parentElement) {\n\t\t\tmainPageView.parentElement!!.insertBefore(\n\t\t\t\tsettingsView,\n\t\t\t\tmainPageView.nextElementSibling,\n\t\t\t);\n\t\t}\n\t\tsettingsView.classList.add(\"ncmm-show\");\n\t\t// \u6709\u4E9B\u4E3B\u9898\u63D2\u4EF6\u4F1A\u7ED9\u6211\u4EEC\u4E3B\u9875\u4E0A !important \u4F18\u5148\u7EA7\u4FEE\u9970\u7B26\n\t\t// \u6240\u4EE5\u5F97\u8FD9\u6837\u786C\u78B0\u786C\n\t\tmainPageView.setAttribute(\"style\", \"display: none !important;\");\n\t}\n\n\tfunction hideSettings() {\n\t\tsettingsView.classList.remove(\"ncmm-show\");\n\t\tmainPageView.removeAttribute(\"style\");\n\t}\n\n\t!(async () => {\n\t\tconst lyricButton = (await BetterNCM.utils.waitForElement(\n\t\t\t\"div.cover.u-cover.u-cover-sm > a > span\",\n\t\t\t1000,\n\t\t))!! as HTMLAnchorElement;\n\t\tlyricButton.addEventListener(\"click\", hideSettings);\n\t})();\n\n\tsettingsButton.addEventListener(\"click\", hideSettings);\n\n\t// \u5982\u679C\u5916\u90E8\u9875\u9762\u53D8\u66F4\uFF08\u70B9\u51FB\u4E86\u5176\u5B83\u6309\u94AE\u8DF3\u8F6C\uFF09\u5219\u5173\u95ED\u8BBE\u7F6E\u9875\u9762\n\twindow.addEventListener(\"hashchange\", hideSettings);\n\tnew MutationObserver((rs) => {\n\t\tfor (const r of rs) {\n\t\t\tif (r.attributeName === \"style\") {\n\t\t\t\t// \u4FA7\u680F\u662F\u53EF\u4EE5\u62D6\u62FD\u6539\u53D8\u5927\u5C0F\u7684\uFF0C\u6240\u4EE5\u6211\u4EEC\u4E5F\u8981\u4E00\u8D77\u540C\u6B65\u4FEE\u6539\n\t\t\t\tsettingsView.style.left = mainPageView.style.left;\n\t\t\t}\n\t\t}\n\t}).observe(mainPageView, {\n\t\tattributes: true,\n\t});\n}\n\nexport let onPluginLoaded = (_: typeof loadedPlugins) => {};\n\nconst PluginManager: React.FC = () => {\n\tconst [selectedPlugin, setSelectedPlugin] = React.useState<NCMPlugin | null>(\n\t\tnull,\n\t);\n\tconst pluginConfigRef = React.useRef<HTMLDivElement | null>(null);\n\tconst [loadedPluginsList, setLoadedPlugins] = React.useState<string[]>([]);\n\tconst [showStartupWarnings, setShowStartupWarnings] = React.useState(\n\t\tlocalStorage.getItem(OPENED_WARNINGS) !== \"true\",\n\t);\n\tconst safeMode = React.useMemo(isSafeMode, undefined);\n\n\tReact.useEffect(() => {\n\t\tfunction sortFunc(key1: string, key2: string) {\n\t\t\tconst getSortValue = (key: string) => {\n\t\t\t\tconst loadPlugin = loadedPlugins[key];\n\t\t\t\tconst value = loadPlugin.haveConfigElement() ? 1 : 0;\n\n\t\t\t\t// \u5C06\u63D2\u4EF6\u5546\u5E97\u6392\u5230\u6700\u524D\u9762\n\t\t\t\tif (loadPlugin.manifest.name.startsWith(\"PluginMarket\"))\n\t\t\t\t\treturn Number.MAX_SAFE_INTEGER;\n\n\t\t\t\treturn value;\n\t\t\t};\n\t\t\treturn getSortValue(key2) - getSortValue(key1);\n\t\t}\n\t\tsetLoadedPlugins(Object.keys(loadedPlugins).sort(sortFunc));\n\t\tonPluginLoaded = (loadedPlugins) => {\n\t\t\tconsole.log(\"\u63D2\u4EF6\u52A0\u8F7D\u5B8C\u6210\uFF01\");\n\t\t\tsetLoadedPlugins(Object.keys(loadedPlugins).sort(sortFunc));\n\t\t};\n\t}, []);\n\n\tReact.useEffect(() => {\n\t\tconst myDomElement =\n\t\t\t(selectedPlugin?.injects\n\t\t\t\t.map((v) => v._getConfigElement())\n\t\t\t\t.filter((v) => v !== null) as HTMLElement[] | null) || [];\n\n\t\tif (myDomElement.length === 0) {\n\t\t\tconst tipElement = document.createElement(\"div\");\n\t\t\ttipElement.innerText = \"\u8BE5\u63D2\u4EF6\u6CA1\u6709\u53EF\u7528\u7684\u8BBE\u7F6E\u9009\u9879\";\n\t\t\tmyDomElement.push(tipElement);\n\t\t}\n\n\t\tpluginConfigRef.current?.replaceChildren(...myDomElement);\n\t}, [selectedPlugin]);\n\n\treturn (\n\t\t<div className=\"bncm-mgr\">\n\t\t\t<div>\n\t\t\t\t<HeaderComponent\n\t\t\t\t\tonRequestOpenStartupWarnings={() => {\n\t\t\t\t\t\tsetShowStartupWarnings(!showStartupWarnings);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t{safeMode ? (\n\t\t\t\t\t<SafeModeInfo />\n\t\t\t\t) : showStartupWarnings ? (\n\t\t\t\t\t<StartupWarning\n\t\t\t\t\t\tonRequestClose={() => {\n\t\t\t\t\t\t\tlocalStorage.setItem(OPENED_WARNINGS, \"true\");\n\t\t\t\t\t\t\tsetShowStartupWarnings(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<section\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\t\t\tflex: \"1\",\n\t\t\t\t\t\t\tmarginBottom: \"0\",\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"v-scroll loaded-plugins-list\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tborderRight: \"1px solid #8885\",\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t{loadedPluginsList.map((key) => {\n\t\t\t\t\t\t\t\t\t\tconst loadPlugin = loadedPlugins[key];\n\t\t\t\t\t\t\t\t\t\tconst haveConfig = loadPlugin.haveConfigElement();\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t// rome-ignore lint/a11y/useKeyWithClickEvents: <explanation>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t\t\t\t\t\t\thaveConfig\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? selectedPlugin?.manifest.slug === key\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"plugin-btn selected\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"plugin-btn\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"plugin-btn-disabled plugin-btn\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tdata-plugin-slug={key}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (haveConfig) setSelectedPlugin(loadPlugin);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"plugin-list-name\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{loadPlugin.manifest.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{key !== \"PluginMarket\" && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t// rome-ignore lint/a11y/useKeyWithClickEvents: <explanation>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"plugin-uninstall-btn\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait BetterNCM.fs.remove(loadPlugin.pluginPath);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tBetterNCM.reload();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth={24}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\theight={24}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstrokeLinejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"feather feather-trash-2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<polyline points=\"3 6 5 6 21 6\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<line x1={10} y1={11} x2={10} y2={17} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<line x1={14} y1={11} x2={14} y2={17} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"v-scroll\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\toverflowY: \"scroll\",\n\t\t\t\t\t\t\t\t\t\toverflowX: \"hidden\",\n\t\t\t\t\t\t\t\t\t\tpadding: \"16px\",\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tref={pluginConfigRef}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n", "export interface InjectFile {\n\tfile: string;\n}\n\nexport interface HijackOperation {\n\ttype: string;\n}\n\nexport interface HijackReplaceOrRegexOperation extends HijackOperation {\n\ttype: \"replace\" | \"regex\";\n\tfrom: string;\n\tto: string;\n}\n\nexport interface HijackAppendOrPrependOperation extends HijackOperation {\n\ttype: \"append\" | \"prepend\";\n\tcode: string;\n}\n\nexport interface PluginManifest {\n\tmanifest_version: number;\n\tname: string;\n\tversion: string;\n\tslug: string;\n\t/** \u662F\u5426\u7981\u7528\u81EA\u5E26\u7684\u5F00\u53D1\u91CD\u8F7D\u529F\u80FD\uFF0C\u9002\u7528\u4E8E\u90A3\u4E9B\u9700\u8981\u81EA\u5236\u70ED\u91CD\u8F7D\u7684\u63D2\u4EF6\u5F00\u53D1\u8005\u4EEC\uFF0C\u9ED8\u8BA4\u4E0D\u7981\u7528 */\n\tnoDevReload?: boolean;\n\tloadAfter?: string[];\n\tloadBefore?: string[];\n\tinjects: { [pageType: string]: InjectFile[] };\n\thijacks: {\n\t\t[versionRange: string]: {\n\t\t\t[matchUrlPath: string]:\n\t\t\t\t| HijackReplaceOrRegexOperation\n\t\t\t\t| HijackAppendOrPrependOperation;\n\t\t};\n\t};\n}\n\nexport class NCMPlugin extends EventTarget {\n\tpluginPath: string = \"\";\n\tinjects: NCMInjectPlugin[] = [];\n\tmanifest: PluginManifest;\n\tfinished: boolean = false;\n\t#haveConfigEle: boolean | null = null;\n\tdevMode: boolean = false;\n\tconstructor(manifest: PluginManifest, pluginPath: string, devMode: boolean) {\n\t\tsuper();\n\t\tthis.devMode = devMode;\n\t\tthis.manifest = manifest;\n\t\tthis.pluginPath = pluginPath;\n\t\tthis.addEventListener(\"load\", (evt: CustomEvent) => {\n\t\t\tthis.injects.forEach((inject) => {\n\t\t\t\tinject.dispatchEvent(evt);\n\t\t\t});\n\t\t});\n\t\tthis.addEventListener(\"allpluginsloaded\", (evt: CustomEvent) => {\n\t\t\tthis.injects.forEach((inject) => {\n\t\t\t\tinject.dispatchEvent(evt);\n\t\t\t});\n\t\t});\n\t}\n\thaveConfigElement() {\n\t\tif (this.#haveConfigEle == null)\n\t\t\tthis.#haveConfigEle =\n\t\t\t\tthis.injects.reduce<HTMLElement | null>(\n\t\t\t\t\t(previous, plugin) => previous ?? plugin._getConfigElement(),\n\t\t\t\t\tnull,\n\t\t\t\t) !== null;\n\t\treturn this.#haveConfigEle;\n\t}\n}\n\nnamespace configToolBox {\n\texport function makeBtn(\n\t\ttext: string,\n\t\tonClick: () => void,\n\t\tsmaller = false,\n\t\targs = {},\n\t) {\n\t\treturn dom(\"a\", {\n\t\t\tclass: [\"u-ibtn5\", smaller && \"u-ibtnsz8\"],\n\t\t\tstyle: { margin: \".2em .5em\" },\n\t\t\tinnerText: text,\n\t\t\tonclick: onClick,\n\t\t\t...args,\n\t\t});\n\t}\n\n\texport function makeCheckbox(args = {}) {\n\t\treturn dom(\"input\", { type: \"checkbox\", ...args });\n\t}\n\n\texport function makeInput(value, args = {}) {\n\t\treturn dom(\"input\", {\n\t\t\tvalue,\n\t\t\tstyle: { margin: \".2em .5em\", borderRadius: \".5em\" },\n\t\t\tclass: [\"u-txt\", \"sc-flag\"],\n\t\t\t...args,\n\t\t});\n\t}\n}\n\nexport class NCMInjectPlugin extends EventTarget {\n\tpluginPath: string = \"\";\n\tmanifest: PluginManifest;\n\tconfigViewElement: HTMLElement | null = null;\n\tmainPlugin: NCMPlugin;\n\tloadError: Error | null = null;\n\tfinished: boolean = false;\n\tconstructor(mainPlugin: NCMPlugin, public readonly filePath: string) {\n\t\tsuper();\n\t\tthis.mainPlugin = mainPlugin;\n\t\tthis.manifest = mainPlugin.manifest;\n\t\tthis.pluginPath = mainPlugin.pluginPath;\n\t}\n\n\tonLoad(fn: (selfPlugin: NCMPlugin, evt: CustomEvent) => void) {\n\t\tthis.addEventListener(\"load\", (evt: CustomEvent) => {\n\t\t\ttry {\n\t\t\t\tfn.call(this, evt.detail, evt);\n\t\t\t} catch (e) {\n\t\t\t\tthis.loadError = e;\n\t\t\t}\n\t\t});\n\t}\n\t// rome-ignore lint/suspicious/noExplicitAny: TODO: \u5DE5\u5177\u7C7B\u53C2\u6570\n\tonConfig(fn: (toolsBox: any) => HTMLElement) {\n\t\tthis.addEventListener(\"config\", (evt: CustomEvent) => {\n\t\t\tthis.configViewElement = fn.call(this, evt.detail);\n\t\t});\n\t}\n\tonAllPluginsLoaded(\n\t\tfn: (loadedPlugins: typeof window.loadedPlugins, evt: CustomEvent) => void,\n\t) {\n\t\tthis.addEventListener(\"allpluginsloaded\", function (evt: CustomEvent) {\n\t\t\tfn.call(this, evt.detail, evt);\n\t\t});\n\t}\n\tgetConfig<T>(key: string): T | undefined;\n\tgetConfig<T>(key: string, defaultValue: T): T;\n\tgetConfig<T>(key: string, defaultValue?: T): T | undefined {\n\t\ttry {\n\t\t\tconst config = JSON.parse(\n\t\t\t\tlocalStorage.getItem(`config.betterncm.${this.manifest.slug}`) || \"{}\",\n\t\t\t);\n\t\t\tif (config[key] !== undefined) return config[key];\n\t\t} catch {}\n\t\treturn defaultValue;\n\t}\n\tsetConfig<T>(key: string, value: T) {\n\t\tlet config = JSON.parse(\n\t\t\tlocalStorage.getItem(`config.betterncm.${this.manifest.slug}`) || \"{}\",\n\t\t);\n\t\tif (!config || typeof config !== \"object\") {\n\t\t\tconfig = Object.create(null);\n\t\t}\n\t\tconfig[key] = value;\n\t\tlocalStorage[`config.betterncm.${this.manifest.slug}`] =\n\t\t\tJSON.stringify(config);\n\t}\n\t_getConfigElement() {\n\t\tif (!this.configViewElement)\n\t\t\tthis.dispatchEvent(new CustomEvent(\"config\", { detail: configToolBox }));\n\t\treturn this.configViewElement;\n\t}\n}\n", "import BetterNCM from \"./betterncm-api\";\nimport { initPluginManager, onPluginLoaded } from \"./plugin-manager\";\nimport { betterncmFetch } from \"./betterncm-api/base\";\nimport { NCMPlugin, NCMInjectPlugin } from \"./plugin\";\n\nexport let loadedPlugins: typeof window.loadedPlugins = {};\n\nconst SAFE_MODE_KEY = \"betterncm.safemode\";\nconst LOAD_ERROR_KEY = \"betterncm.loaderror\";\nconst CPP_SIDE_INJECT_DISABLE_KEY =\n\t\"cc.microblock.betterncm.cpp_side_inject_feature_disabled\";\n\n/**\n * \u7981\u7528\u5B89\u5168\u6A21\u5F0F\uFF0C\u5C06\u4F1A\u5728\u4E0B\u4E00\u6B21\u91CD\u8F7D\u751F\u6548\n *\n * \u8BE6\u60C5\u8BF7\u53C2\u9605 `enableSafeMode`\n *\n * @see {@link enableSafeMode}\n */\nexport async function disableSafeMode() {\n\tawait BetterNCM.app.writeConfig(CPP_SIDE_INJECT_DISABLE_KEY, \"false\");\n\tlocalStorage.removeItem(SAFE_MODE_KEY);\n\tlocalStorage.removeItem(LOAD_ERROR_KEY);\n}\n\n/**\n * \u542F\u7528\u5B89\u5168\u6A21\u5F0F\uFF0C\u5C06\u4F1A\u5728\u4E0B\u4E00\u6B21\u91CD\u8F7D\u751F\u6548\n *\n * \u5728\u8BE5\u6A21\u5F0F\u4E0B\uFF0C\u53EA\u4F1A\u52A0\u8F7D\u63D2\u4EF6\u7BA1\u7406\u5668\u672C\u8EAB\uFF0C\u6240\u6709\u63D2\u4EF6\uFF08\u5305\u62EC\u63D2\u4EF6\u5546\u5E97\uFF09\u5C06\u4F1A\u88AB\u5FFD\u7565\u52A0\u8F7D\n *\n * \u540C\u65F6\u5982\u679C\u6709\u52A0\u8F7D\u9519\u8BEF\u7684\u60C5\u51B5\u7684\u8BDD\uFF08\u5373\u8BBE\u7F6E\u4E86 `LOAD_ERROR_KEY`\uFF09\u5219\u4F1A\u5728\u63D2\u4EF6\u7BA1\u7406\u5668\u5185\u663E\u793A\n *\n * \u4F9B\u7528\u6237\u548C\u63D2\u4EF6\u4F5C\u8005\u6392\u67E5\u52A0\u8F7D\u9519\u8BEF\n */\nexport async function enableSafeMode() {\n\tawait BetterNCM.app.writeConfig(CPP_SIDE_INJECT_DISABLE_KEY, \"true\");\n\tlocalStorage.setItem(SAFE_MODE_KEY, \"true\");\n}\n\nexport class PluginLoadError extends Error {\n\tconstructor(\n\t\tpublic readonly pluginPath: string,\n\t\tpublic readonly rawError: Error,\n\t\tmessage?: string,\n\t\toptions?: ErrorOptions,\n\t) {\n\t\tsuper(message, options);\n\t}\n\n\toverride toString(): string {\n\t\treturn `\u63D2\u4EF6 ${this.pluginPath} \u52A0\u8F7D\u51FA\u9519: ${this.rawError}`;\n\t}\n}\n\nexport class DependencyResolveError extends Error {\n\tconstructor(message?: string, options?: ErrorOptions) {\n\t\tsuper(message, options);\n\t}\n\n\toverride toString(): string {\n\t\treturn `\u63D2\u4EF6\u4F9D\u8D56\u89E3\u6790\u51FA\u9519: ${this}`;\n\t}\n}\n\nexport const isSafeMode = () => localStorage.getItem(SAFE_MODE_KEY) === \"true\";\n\nexport const getLoadError = () => localStorage.getItem(LOAD_ERROR_KEY) || \"\";\n\nfunction sortPlugins(plugins: NCMPlugin[]) {\n\tclass Graph {\n\t\tadjacencyList = {};\n\t\tconstructor() {}\n\t\taddVertex(vertex: string) {\n\t\t\tif (!this.adjacencyList[vertex]) {\n\t\t\t\tthis.adjacencyList[vertex] = [];\n\t\t\t}\n\t\t}\n\t\taddEdge(v1: string, v2: string) {\n\t\t\tthis.adjacencyList[v1].push(v2);\n\t\t}\n\t}\n\n\tconst graph = new Graph();\n\tfor (const plugin of plugins) graph.addVertex(plugin.manifest.slug);\n\tfor (const plugin of plugins) {\n\t\tif (plugin.manifest.loadBefore)\n\t\t\tplugin.manifest.loadBefore.forEach((dep) =>\n\t\t\t\tgraph.addEdge(dep, plugin.manifest.slug),\n\t\t\t);\n\t\tif (plugin.manifest.loadAfter)\n\t\t\tplugin.manifest.loadAfter.forEach((dep) =>\n\t\t\t\tgraph.addEdge(plugin.manifest.slug, dep),\n\t\t\t);\n\t}\n\n\tfunction dfsTopSortHelper(\n\t\tv: string,\n\t\tn: number,\n\t\tvisited: { [x: string]: boolean },\n\t\ttopNums: { [x: string]: number },\n\t) {\n\t\tvisited[v] = true;\n\t\tif (!(v in graph.adjacencyList))\n\t\t\tthrow new DependencyResolveError(`\u627E\u4E0D\u5230\u63D2\u4EF6 ${v}`);\n\t\tconst neighbors = graph.adjacencyList[v];\n\t\tfor (const neighbor of neighbors) {\n\t\t\tif (!visited[neighbor]) {\n\t\t\t\tn = dfsTopSortHelper(neighbor, n, visited, topNums);\n\t\t\t}\n\t\t}\n\t\ttopNums[v] = n;\n\t\treturn n - 1;\n\t}\n\n\tconst vertices = Object.keys(graph.adjacencyList);\n\tconst visited = {};\n\tconst topNums = {};\n\tlet n = vertices.length - 1;\n\tfor (const v of vertices) {\n\t\tif (!visited[v]) {\n\t\t\tn = dfsTopSortHelper(v, n, visited, topNums);\n\t\t}\n\t}\n\treturn Object.keys(topNums).map((slug) =>\n\t\tplugins.find((plugin) => plugin.manifest.slug === slug),\n\t);\n}\n\nasync function loadPlugins() {\n\tif (isSafeMode()) {\n\t\twindow.loadedPlugins = loadedPlugins;\n\t\treturn;\n\t}\n\n\tconst debouncedReload = BetterNCM.utils.debounce(BetterNCM.reload, 1000);\n\n\t// rome-ignore lint/suspicious/noExplicitAny: AsyncFunction \u5E76\u4E0D\u66B4\u9732\u6210\u7C7B\uFF0C\u9700\u8981\u624B\u52A8\u83B7\u53D6\n\tconst AsyncFunction = async function () {}.constructor as any;\n\tconst pageMap = {\n\t\t\"/pub/app.html\": \"Main\",\n\t};\n\tconst pageName = pageMap[location.pathname];\n\n\tasync function loadPlugin(mainPlugin: NCMPlugin) {\n\t\tconsole.log(\"\u6B63\u5728\u52A0\u8F7D\u63D2\u4EF6\", mainPlugin.manifest.name);\n\t\tconst devMode = mainPlugin.devMode;\n\t\tconst manifest = mainPlugin.manifest;\n\t\tconst pluginPath = mainPlugin.pluginPath;\n\n\t\tif (devMode && !manifest.noDevReload) {\n\t\t\ttry {\n\t\t\t\tbetterncm_native.fs.watchDirectory(pluginPath, (_dir, path) => {\n\t\t\t\t\tconst RELOAD_EXTS = [\".js\", \"manifest.json\"];\n\t\t\t\t\tif (RELOAD_EXTS.findIndex((ext) => path.endsWith(ext)) !== -1) {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\"\u5F00\u53D1\u63D2\u4EF6\",\n\t\t\t\t\t\t\tmanifest.name,\n\t\t\t\t\t\t\t\"\u6587\u4EF6\",\n\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\t\"\u53D1\u751F\u66F4\u65B0\uFF0C\u5373\u5C06\u91CD\u8F7D\uFF01\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdebouncedReload();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t}\n\n\t\tasync function loadInject(filePath: string) {\n\t\t\tif (!manifest.slug) return;\n\t\t\tconst code = await BetterNCM.fs.readFileText(filePath);\n\n\t\t\tif (filePath.endsWith(\".js\")) {\n\t\t\t\tconst plugin = new NCMInjectPlugin(mainPlugin, filePath);\n\t\t\t\ttry {\n\t\t\t\t\tconst loadingPromise = new AsyncFunction(\"plugin\", code).call(\n\t\t\t\t\t\tloadedPlugins[manifest.slug],\n\t\t\t\t\t\tplugin,\n\t\t\t\t\t);\n\t\t\t\t\tawait loadingPromise;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new PluginLoadError(\n\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\terr,\n\t\t\t\t\t\t`\u63D2\u4EF6\u811A\u672C ${filePath} \u89E3\u6790\u51FA\u9519: ${err.stack || err}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcause: err,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tplugin.dispatchEvent(\n\t\t\t\t\tnew CustomEvent(\"load\", {\n\t\t\t\t\t\tdetail: plugin,\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t\tif (plugin.loadError) {\n\t\t\t\t\tthrow new PluginLoadError(\n\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\tplugin.loadError,\n\t\t\t\t\t\t`\u63D2\u4EF6\u811A\u672C ${filePath} \u52A0\u8F7D\u51FA\u9519: ${\n\t\t\t\t\t\t\tplugin.loadError.stack || plugin.loadError\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcause: plugin.loadError,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tplugin.finished = true;\n\t\t\t\tloadedPlugins[manifest.slug].injects.push(plugin);\n\t\t\t}\n\t\t}\n\n\t\t// Load Injects\n\t\tif (manifest.injects[pageName]) {\n\t\t\tfor (const inject of manifest.injects[pageName]) {\n\t\t\t\tawait loadInject(`${pluginPath}/${inject.file}`);\n\t\t\t}\n\t\t}\n\n\t\tif (manifest.injects[location.pathname]) {\n\t\t\tfor (const inject of manifest.injects[location.pathname]) {\n\t\t\t\tawait loadInject(`${pluginPath}/${inject.file}`);\n\t\t\t}\n\t\t}\n\t\tmainPlugin.finished = true;\n\t}\n\n\twindow.loadedPlugins = loadedPlugins;\n\n\tconst pluginPaths = (await BetterNCM.fs.readDir(\"./plugins_runtime\")).filter(\n\t\t(path) => {\n\t\t\treturn !path.substring(path.lastIndexOf(\"/\")).startsWith(\"/.\");\n\t\t},\n\t);\n\n\tlet plugins: NCMPlugin[] = [];\n\n\tconst loadPluginByPath = async (path: string, devMode: boolean) => {\n\t\tif (!(await BetterNCM.fs.exists(`${path}/manifest.json`))) return;\n\t\ttry {\n\t\t\tconst manifest = JSON.parse(\n\t\t\t\tawait BetterNCM.fs.readFileText(`${path}/manifest.json`),\n\t\t\t);\n\n\t\t\tmanifest.slug ??= manifest.name\n\t\t\t\t.replace(/[^a-zA-Z0-9 ]/g, \"\")\n\t\t\t\t.replace(/ /g, \"-\");\n\n\t\t\tconst mainPlugin = new NCMPlugin(manifest, path, devMode);\n\t\t\tplugins.push(mainPlugin);\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) console.error(\"\u63D2\u4EF6\u52A0\u8F7D\u5931\u8D25\uFF1A\", e);\n\t\t\telse {\n\t\t\t\tconsole.warn(\"\u89E3\u6790\u63D2\u4EF6\u5143\u6570\u636E\u5931\u8D25\uFF1A\", path, e);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t};\n\n\tplugins = sortPlugins(plugins) as NCMPlugin[];\n\n\tconst preloadPromises: Promise<void>[] = [];\n\tfor (const path of pluginPaths)\n\t\tpreloadPromises.push(loadPluginByPath(path, false));\n\n\tif (await BetterNCM.fs.exists(\"./plugins_dev\")) {\n\t\tconst devPluginPaths = await BetterNCM.fs.readDir(\"./plugins_dev\");\n\t\tfor (const path of devPluginPaths)\n\t\t\tpreloadPromises.push(loadPluginByPath(path, true));\n\t}\n\n\tawait Promise.all(preloadPromises);\n\n\tconst loadingPromises = plugins.map(\n\t\t(plugin) => {\n\t\t\tif (!(plugin.manifest.slug in loadedPlugins)) {\n\t\t\t\tloadedPlugins[plugin.manifest.slug] = plugin;\n\t\t\t\treturn loadPlugin(plugin);\n\t\t\t} else {\n\t\t\t\tconsole.warn(\n\t\t\t\t\tplugin.manifest.slug,\n\t\t\t\t\t\"duplicated, the plugin at\",\n\t\t\t\t\tplugin.pluginPath,\n\t\t\t\t\t\"wont be loaded.\",\n\t\t\t\t);\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t},\n\t);\n\n\ttry {\n\t\tawait Promise.all(loadingPromises);\n\t} catch (e) {\n\t\tconsole.warn(\"\u63D2\u4EF6\u52A0\u8F7D\u51FA\u9519\uFF01\", e, e.name, e.stack);\n\t}\n\n\tfor (const name in loadedPlugins) {\n\t\tconst plugin: NCMPlugin = loadedPlugins[name];\n\t\tplugin.injects.forEach((inject) => {\n\t\t\tinject.dispatchEvent(\n\t\t\t\tnew CustomEvent(\"allpluginsloaded\", { detail: loadedPlugins }),\n\t\t\t);\n\t\t\tif (inject.loadError) {\n\t\t\t\tthrow new PluginLoadError(\n\t\t\t\t\tinject.filePath,\n\t\t\t\t\tinject.loadError,\n\t\t\t\t\t`\u63D2\u4EF6\u811A\u672C ${inject.filePath} \u52A0\u8F7D\u51FA\u9519: ${\n\t\t\t\t\t\tinject.loadError.stack || inject.loadError\n\t\t\t\t\t}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tcause: inject.loadError,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n}\n\nasync function onLoadError(e: Error) {\n\tconst ATTEMPTS_KEY = \"cc.microblock.loader.reloadPluginAttempts\";\n\tconst attempts = parseInt(localStorage.getItem(ATTEMPTS_KEY) || \"0\");\n\tconst pastError = localStorage.getItem(LOAD_ERROR_KEY) || \"\";\n\tlocalStorage.setItem(\n\t\tLOAD_ERROR_KEY,\n\t\t`${pastError}\u7B2C ${attempts + 1} \u6B21\u52A0\u8F7D\u53D1\u751F\u9519\u8BEF\uFF1A\\n${e.stack || e}\\n\\n`,\n\t);\n\tif (attempts < 2) {\n\t\tlocalStorage.setItem(ATTEMPTS_KEY, String(attempts + 1));\n\t} else {\n\t\tawait enableSafeMode();\n\t\tlocalStorage.removeItem(ATTEMPTS_KEY);\n\t}\n\t// document.location.reload();\n}\n\ndeclare const loadingMask: HTMLDivElement;\nwindow.addEventListener(\"DOMContentLoaded\", async () => {\n\ttry {\n\t\t// \u52A0\u8F7D\u7BA1\u7406\u5668\u6837\u5F0F\u8868\n\t\tconst styleContent = await (\n\t\t\tawait betterncmFetch(\"/internal/framework.css\")\n\t\t).text();\n\t\tconst styleEl = document.createElement(\"style\");\n\t\tstyleEl.innerHTML = styleContent;\n\t\tdocument.head.appendChild(styleEl);\n\n\t\tawait initPluginManager();\n\n\t\ttry {\n\t\t\tawait loadPlugins();\n\t\t} catch (e) {\n\t\t\tconsole.warn(e, e.stack);\n\t\t}\n\n\t\t// try {\n\t\t// \tawait Promise.race([\n\t\t// \t\tPromise.all([loadPlugins(), initPluginManager()]),\n\t\t// \t\tBetterNCM.utils.delay(2000),\n\t\t// \t]);\n\t\t// } catch (e) {\n\t\t// \tonLoadError(e);\n\t\t// \treturn;\n\t\t// }\n\n\t\tif (\"loadingMask\" in window) {\n\t\t\tconst anim = loadingMask.animate(\n\t\t\t\t[{ opacity: 1 }, { opacity: 0, display: \"none\" }],\n\t\t\t\t{\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tfill: \"forwards\",\n\t\t\t\t\teasing: \"cubic-bezier(0.42,0,0.58,1)\",\n\t\t\t\t},\n\t\t\t);\n\t\t\tanim.commitStyles();\n\t\t}\n\t\tonPluginLoaded(loadedPlugins); // \u66F4\u65B0\u63D2\u4EF6\u7BA1\u7406\u5668\u90A3\u8FB9\u7684\u63D2\u4EF6\u5217\u8868\n\t} catch (err) {\n\t\tdocument.body.innerHTML = err;\n\t}\n});\n"],
  "mappings": "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",
  "names": ["utils", "waitForElement", "selector", "interval", "waitForFunction", "debounce", "callback", "waitTime", "timer", "self", "args", "escapeData", "data", "encoded", "result", "i", "func", "rs", "handle", "delay", "ms", "dom", "tag", "settings", "children", "tmp", "cl", "v", "child", "initNCMReact", "utils", "betterncmFetch", "relPath", "option", "uid", "_uid", "IDX", "HEX", "SIZE", "BUFFER", "len", "i", "tmp", "webkitPostMessage", "callType", "args", "resolve", "reject", "id", "result", "err", "e", "fs", "readDir", "folderPath", "betterncmFetch", "readFileText", "filePath", "readFile", "mountDir", "mountFile", "unzip", "zipPath", "unzipDest", "r", "writeFileText", "content", "writeFile", "data", "utils", "webkitPostMessage", "rawData", "fd", "mkdir", "dirPath", "exists", "path", "remove", "e", "app", "exec", "cmd", "elevate", "showWindow", "betterncmFetch", "betterNCMVersion", "getBetterNCMVersion", "takeBackgroundScreenshot", "getNCMWinPos", "reloadPlugins", "getDataPath", "readConfig", "key", "defaultValue", "writeConfig", "value", "getNCMPath", "showConsole", "webkitPostMessage", "setRoundedCorner", "enable", "openFileDialog", "filter", "initialDir", "isLightTheme", "getSucceededHijacks", "ncm", "findNativeFunction", "obj", "identifiers", "key", "flag", "_i", "identifiers_1", "identifier", "openUrl", "url", "getNCMPackageVersion", "getNCMFullVersion", "getNCMVersion", "v", "getNCMBuild", "waitTick", "resolve", "searchApiFunction", "nameOrFinder", "root", "currentPath", "prevObjects", "result", "searchForData", "finder", "findApiFunction", "cachedGetPlayingFunc", "getPlayingSong", "findResult", "getPlaying", "getPlayingRoot", "playing", "tests", "fail", "reason", "fs", "success", "message", "reload", "anim", "_", "BetterNCM", "fs", "app", "ncm", "utils", "tests", "betterncmFetch", "utils", "BetterNCM", "betterncm_api_default", "Button", "props", "children", "className", "other", "ProgressRing", "props", "HeaderComponent", "props", "updateButtonColor", "setUpdateButtonColor", "safeMode", "isSafeMode", "latestVersion", "setLatestVersion", "currentVersion", "setCurrentVersion", "betterNCMVersion", "betterncm_api_default", "currentNCMVersion", "onlineSuitableVersions", "v", "onUpdateButtonClicked", "ncmpath", "dllpath", "Button", "disableSafeMode", "ProgressRing", "SafeModeInfo", "loadError", "getLoadError", "StartupWarning", "props", "betterncm_api_default", "OPENED_WARNINGS", "initPluginManager", "settingsView", "mainPageView", "betterncm_api_default", "settingsButton", "betterNCMSettingsButton", "hideSettings", "showSettings", "PluginManager", "rs", "r", "onPluginLoaded", "_", "selectedPlugin", "setSelectedPlugin", "pluginConfigRef", "loadedPluginsList", "setLoadedPlugins", "showStartupWarnings", "setShowStartupWarnings", "safeMode", "isSafeMode", "sortFunc", "key1", "key2", "getSortValue", "key", "loadPlugin", "loadedPlugins", "value", "myDomElement", "v", "tipElement", "HeaderComponent", "SafeModeInfo", "StartupWarning", "haveConfig", "e", "NCMPlugin", "#haveConfigEle", "manifest", "pluginPath", "devMode", "evt", "inject", "previous", "plugin", "configToolBox", "makeBtn", "text", "onClick", "smaller", "args", "makeCheckbox", "makeInput", "value", "NCMInjectPlugin", "mainPlugin", "filePath", "fn", "e", "key", "defaultValue", "config", "loadedPlugins", "SAFE_MODE_KEY", "LOAD_ERROR_KEY", "CPP_SIDE_INJECT_DISABLE_KEY", "disableSafeMode", "betterncm_api_default", "PluginLoadError", "pluginPath", "rawError", "message", "options", "DependencyResolveError", "isSafeMode", "SAFE_MODE_KEY", "getLoadError", "LOAD_ERROR_KEY", "sortPlugins", "plugins", "Graph", "vertex", "v1", "v2", "graph", "plugin", "dep", "dfsTopSortHelper", "v", "n", "visited", "topNums", "neighbors", "neighbor", "vertices", "slug", "loadPlugins", "loadedPlugins", "debouncedReload", "betterncm_api_default", "AsyncFunction", "pageName", "loadPlugin", "mainPlugin", "devMode", "manifest", "_dir", "path", "ext", "loadInject", "filePath", "code", "NCMInjectPlugin", "err", "inject", "pluginPaths", "loadPluginByPath", "NCMPlugin", "e", "preloadPromises", "devPluginPaths", "loadingPromises", "name", "styleContent", "betterncmFetch", "styleEl", "initPluginManager", "loadPlugins", "e", "onPluginLoaded", "loadedPlugins", "err"]
}
